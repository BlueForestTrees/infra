version: '2'
services:
  user:
    image: blueforest/user:latest
    environment:
      DB_HOST: mongo
      DB_USER: XXX
      DB_PWD: YYY
      NODE_ENV: production
      PORT: '8080'
      DEBUG: api:*
      AUTH_TOKEN_SECRET: ZZZ
    links:
    - mongo:database
    volumes:
      - /etc/user:/etc/user
  facet:
    image: blueforest/facet:latest
    environment:
      DB_HOST: mongo
      DB_USER: XXX
      DB_PWD: YYY
      NODE_ENV: production
      PORT: '8080'
      DEBUG: api:*
      TREE_BASE_URL: "http://trees:8080"
    links:
    - mongo:database
    - trees:trees
  categorie:
    image: blueforest/categorie:latest
    environment:
      DB_HOST: mongo
      DB_USER: XXX
      DB_PWD: YYY
      NODE_ENV: production
      PORT: '8080'
      DEBUG: api:*
    links:
    - mongo:database
  feedback:
    image: blueforest/feedback:latest
    environment:
      DB_HOST: mongo
      DB_USER: XXX
      DB_PWD: YYY
      NODE_ENV: production
      PORT: '8080'
      DEBUG: api:*
    links:
    - mongo:database
  grandeur:
    image: blueforest/grandeur:latest
    environment:
      NODE_ENV: production
      PORT: '8080'
      DEBUG: api:*
  import:
    image: blueforest/import:latest
    environment:
      DB_HOST: mongo
      DB_USER: XXX
      DB_PWD: YYY
      NODE_ENV: production
      PORT: '8080'
      DEBUG: api:*
      USER_BASE_URL: "http://user:8080"
    links:
    - mongo:database
    - user:user
  trees:
    image: blueforest/trees:latest
    environment:
      DB_HOST: mongo
      DB_USER: XXX
      DB_PWD: YYY
      NODE_ENV: production
      PORT: '8080'
      DEBUG: api:*
    links:
    - mongo:database
  mongo:
    image: mongo:latest
    environment:
      MONGO_DATA_DIR: /data/db
      MONGO_LOG_DIR: /dev/null
      MONGO_INITDB_ROOT_USERNAME: XXX
      MONGO_INITDB_ROOT_PASSWORD: YYY
    volumes:
    - /var/lib/trees/mongo:/data/db
    command: mongod --auth
    ports:
    - 27277:27017
  api:
    image: openresty/openresty:alpine
    volumes:
    - /etc/nginx/blueforest.org/api/:/usr/local/openresty/nginx/conf/:ro
    environment:
      JWT_SECRET: ZZZ
    links:
    - trees:trees
    - user:user
    - categorie:categorie
    - feedback:feedback
    - grandeur:grandeur
    - import:import
  web:
    image: nginx:latest
    volumes:
    - /etc/nginx/blueforest.org/web:/etc/nginx:ro
    - /var/www/blueforest.org:/var/www:ro