lua_package_path "/etc/nginx/lua/?.lua;;";

server {
        listen 80;
        listen [::]:80;
        root /var/www;
        index index.html;
        location /api/categorie {
                proxy_pass http://categorie:8080;
        }
        location /api/feedback {
                proxy_pass http://feedback:8080;
        }
        location /api/grandeur {
                proxy_pass http://grandeur:8080;
        }
        location /api/import {
                proxy_pass http://import:8080;
        }
        location /api/tree {
                proxy_pass http://trees:8080;
        }
        location /api/auth {
                proxy_pass http://auth:8080;
        }
        location /api/grandeurs {
                access_by_lua_block {
                    local gt = require "gateway"
                    gt:verifyToken()
                }

                proxy_pass http://grandeur:8080;
            }

}